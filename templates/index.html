<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Conference</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Video Conference</h1>
        <button id="createMeeting" class="btn" onclick="showCreateMeetingModal()">Create New Meeting</button>
        <button id="joinMeetingByCode" class="btn">Join Meeting by Code</button>
        <div id="chat" style="height: 200px; overflow-y: scroll;"></div>
        <input type="text" id="messageInput" placeholder="Type your message...">
        <button id="sendMessage">Send</button>
    </div>

    <div id="optionsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideOptions()">&times;</span>
            <h2>Create New Meeting</h2>
            <input type="text" id="meetingName" placeholder="Meeting Name"><br>
            <input type="datetime-local" id="meetingDateTime"><br>
            <button onclick="createMeeting()" class="btn">Create</button>
        </div>
    </div>

    <div id="joinModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideOptions()">&times;</span>
            <h2>Join Meeting by Code</h2>
            <input type="text" id="meetingCode" placeholder="Meeting Code"><br>
            <label for="camera">Camera:</label>
            <select id="camera">
                <option value="front">Front</option>
                <option value="back">Back</option>
            </select><br>
            <label for="microphone">Microphone:</label>
            <select id="microphone">
                <option value="on">On</option>
                <option value="off">Off</option>
            </select><br>
            <button onclick="joinMeetingByCode()" class="btn">Join</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const socket = io();

        socket.on('message', (data) => {
            $('#chat').append(`<p><strong>${data.username}</strong>: ${data.message}</p>`);
            $('#chat').scrollTop($('#chat')[0].scrollHeight);
        });

        $('#sendMessage').click(() => {
            const message = $('#messageInput').val();
            const username = 'User'; // Replace with actual username logic if needed
            socket.emit('message', { username, message });
            $('#messageInput').val('');
        });

        $('#messageInput').keypress(function (e) {
            if (e.which === 13) {
                $('#sendMessage').click();
            }
        });

        function showOptions(modalId) {
            document.getElementById(modalId).style.display = "block";
        }

        function hideOptions() {
            document.getElementById("optionsModal").style.display = "none";
            document.getElementById("joinModal").style.display = "none";
        }

        function showCreateMeetingModal() {
            showOptions('optionsModal');
        }

        function createMeeting() {
            var meetingName = document.getElementById("meetingName").value;
            var meetingDateTime = document.getElementById("meetingDateTime").value;
            alert("Creating new meeting \"" + meetingName + "\" on " + meetingDateTime);
            hideOptions();
        }

        function joinMeetingByCode() {
            let meetingCode = document.getElementById("meetingCode").value;
            let camera = document.getElementById("camera").value;
            let microphone = document.getElementById("microphone").value;
            alert("Joining meeting with code " + meetingCode + " using camera " + camera + " and microphone " + microphone);
            let url = "video_conferencing.html";
            window.location.href = url;
        }

        document.getElementById('joinMeetingByCode').addEventListener('click', function() { showOptions('joinModal'); });
    </script>
</body>
</html>
